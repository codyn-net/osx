#!/bin/bash

pushd $(dirname $(dirname "$0")) > /dev/null
d=$(pwd -P)
popd > /dev/null

b="$d/.brew"
bb="$d/.brewbuild"

brew="$b/bin/brew"
brewbuild="$bb/bin/brew"

export MACOSX_DEPLOYMENT_TARGET="10.9"

export PATH="$bb/bin:$PATH"
export PKG_CONFIG_PATH="$bb/lib/pkgconfig:$PKG_CONFIG_PATH"

export HOMEBREW_SDKROOT="/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX$MACOSX_DEPLOYMENT_TARGET.sdk"
export SDKROOT="/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX$MACOSX_DEPLOYMENT_TARGET.sdk"

if [ -z "$dont_setup_brew" ] && [ -x "$brew" ]; then
	export PATH="$b/bin:$PATH"

	for pkg in libffi pixman fontconfig freetype; do
		pkgpath=$($brew --prefix $pkg)
		export PKG_CONFIG_PATH="$pkgpath/lib/pkgconfig:$PKG_CONFIG_PATH"
	done

	export PKG_CONFIG_PATH="$b/lib/pkgconfig:$PKG_CONFIG_PATH"
fi

prefix="/Library/Frameworks/Codyn.framework/Resources"
